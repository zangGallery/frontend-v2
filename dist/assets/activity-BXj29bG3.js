import{r as e}from"./web3-core-DPDfnnte.js";import{a as r}from"./react-vendor-z79Uuty_.js";import{p as s,c as d,v as c,H as E}from"./index-CTMr4hGG.js";import"./ui-vendor-51-FR4Jz.js";import"./md-editor-2-khWZ_d.js";import{N as j,p as C}from"./NFTHistory-DN__D6Jk.js";import"./rainbowkit-BIkuclrH.js";let x=null,v=null;const T=6e4;function P(){const u=d.contractAddresses.v1.zang,n=d.contractAddresses.v1.marketplace,[o,i]=r.useState(null),[f,l]=r.useState(!0),p=r.useCallback(async()=>{if(x&&v&&Date.now()-v<T){i(x),l(!1);return}l(!0);try{const k=await s.getBlockNumber(),a=BigInt(Math.max(Number(k)-5e4,d.firstBlocks.v1.base.zang)),[b,g,h,y]=await Promise.all([s.getContractEvents({address:u,abi:c.zang,eventName:"TransferSingle",fromBlock:a}),s.getContractEvents({address:n,abi:c.marketplace,eventName:"TokenListed",fromBlock:a}),s.getContractEvents({address:n,abi:c.marketplace,eventName:"TokenDelisted",fromBlock:a}),s.getContractEvents({address:n,abi:c.marketplace,eventName:"TokenPurchased",fromBlock:a})]),N=[...b.map(t=>({...t,event:"TransferSingle"})),...g.map(t=>({...t,event:"TokenListed"})),...h.map(t=>({...t,event:"TokenDelisted"})),...y.map(t=>({...t,event:"TokenPurchased"}))].sort((t,m)=>Number(m.blockNumber)!==Number(t.blockNumber)?Number(m.blockNumber)-Number(t.blockNumber):m.logIndex-t.logIndex).slice(0,100);x=N,v=Date.now(),i(N)}catch{i([])}finally{l(!1)}},[u,n]);return r.useEffect(()=>{p()},[p]),e.jsxs("div",{className:"min-h-screen bg-ink-950",children:[e.jsx(E,{}),e.jsxs("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-12",children:[e.jsx("h1",{className:"text-3xl md:text-4xl font-mono font-bold text-center text-white mb-8",children:"Recent Activity"}),e.jsx("div",{className:"bg-ink-900/50 rounded-2xl border border-ink-800 p-6",children:f?e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 gap-3",children:[e.jsxs("svg",{className:"animate-spin h-8 w-8 text-accent-cyan",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),e.jsx("span",{className:"text-ink-400",children:"Loading activity..."})]}):o&&o.length===0?e.jsx("div",{className:"text-center py-12 text-ink-400",children:"No recent activity"}):e.jsx(j,{history:C(o),newestFirst:!0})})]})]})}export{P as default};
